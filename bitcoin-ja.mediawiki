<pre>
  Title: Translation of Satoshi's Bitcoin whitepaper
  Author: Atsuki Takahashi <@AtsukiTak>, Yuya Furusawa <@Yuya-Furusawa>
  Created: 2018-01-22
  License: MIT
</pre>

==概要==

純粋にピア・トゥー・ピアで運用される電子通貨が存在すれば、金融機関を介することなく2者間で直接支払いを行うことが可能になる。
電子署名の利用によって部分的にそれは実現するが、２重支払いの防止のために第三者機関を利用する場合、その電子通貨の主要なメリットは失われる。
そこで私達は二重支払いの防止に関して、ピア・トゥー・ピアなネットワークを利用した解決方法を提案する。
そのネットワークは取引をハッシュ化し、あるチェーンの中に保存することで、取引にタイムスタンプを付与する。
このチェーンとはハッシュをベースにしたproof of workのチェーンで、proof of workをやり直さない限り変更することができない。
そして最も長いチェーンは過去に起きたイベントを証明するだけでなく、最も多くのCPUパワーを使ってそのチェーンが生み出されたという事実も証明する。
過半数のCPUパワーが攻撃者によって運用されない限り、誠実な参加者達は攻撃者よりも早いペースで最長のチェーンを更新し続ける。
また、ネットワークそれ自体は最小限の構成しか必要としない。
メッセージは最善努力のもと伝搬され、ノードは任意のタイミングでネットワークに対し離脱、参加できる。
ネットワークに参加していない最中に起きたことへの証明として、ノードは参加時に最長のproof-of-work チェーンを受け取る。


==イントロダクション==

オンラインでのペイメントを実現するため、インターネット上の小売店はほとんど全面的に、信頼できる第三者機関として金融機関に依存してきた。
そのシステムは多くの取引に対して十分に稼働しているものの、信頼ベースのシステム固有の問題に未だに悩まされている。
さらにそのシステムでは、絶対に覆されることない取引というものは実現不可能である。
なぜならば金融機関は利用者間の紛争を解決するために、過去の取引を取り消したりする必要があるからである。
紛争解決を行うために取引のコストが増加してしまうので、実用的な取引サイズの最小値は制限され、少額の手軽な取引も難しくなり、さらには「破棄されることのない取引は実現不可能」という事実が、「不可逆のサービス」を提供している者たちにとっての障害となっている。
もちろん、破棄の可能性が高くなればなるほど、取引者間の信頼がさらに必要になる。
そのような状況下では販売者は顧客に対して用心深くなる必要があり、顧客に対して必要以上の情報請求をしてしまうだろう。
それでも、ある程度は詐欺が起こることも避けられないものとして受け入れる必要がある。
これらのリスクや支払いの不確実性は、相対で物理的な通貨を使うときは起こらない。
しかし信頼されている第三者機関の仲介なしに、何らかのコミュニケーションチャネル（インターネットなど）を通じて支払いを行うことのできるメカニズムは未だ存在していない。

必要なのは、信頼ではなく暗号学的証明に基づいた電子支払いシステムである。
そのシステム上では、取引者同士が"信頼された第三者機関"を必要とすることなく直接取引を行うことが可能となる。
さらにその取引は計算上覆すことが非常に難しいため、小売店は詐欺の被害を減らせるだろう。
また、消費者を守るための機械的なエスクローのメカニズムも簡単に実現することができる。
この論文では、ピア・トゥー・ピアで運用されるタイムスタンプサーバーを利用した、二重支払い問題への解決策を提案する。
そのタイムスタンプサーバーは取引の時間的な順序を計算的に証明する。
そしてそのシステムは誠実な参加者が攻撃者に比べて多くのCPUパワーを占めている限り安全である。

==トランザクション==

ここで、電子コインを電子署名のチェーンとして定義する。
それぞれのコインの所有者は、直前のトランザクションと次の所有者の公開鍵のハッシュに署名し、それをトランザクションの最後に付与することによってコインを送金する。
受取人は署名を検証することで所有権のチェーンを確かめられる。

<img src=img/transactions.png></img>

もちろん、二重支払いの問題はまだ解決していない。
受取人は送金者が事前にそのコインを使用していないことを確認することが不可能である。
よくある解決策は、信用された中央管理者、もしくは通貨発行者を導入することである。
彼らは二重支払いを防止するため、すべてのトランザクションをチェックする。
このやり方では、各トランザクションの後、新しいコインを発行するために使用されたコインは必ず通貨発行者の元へ返されなければならない。
通貨発行者から直接発行された通貨のみが、二重支払いに使用されていないと信用されるのだ。
このやり方の問題点は、この金融システム全体のが通貨発行者に依存するという点である。

前の所有者がコインを以前に使用していないということを受取人が確認できる方法が必要である。
ここではもし同じコインが複数の取引に使用された場合、一番最初の取引のみが正当な取引であるとする。
よってそれ以降の取引による二重支払いについては考慮しない。
取引が行われていないことを確認する唯一の方法は、全ての取引を確認することである。
通貨発行者ベースのモデルにおいて、通貨発行者は全ての取引について確認し、どれが最初に受領されたかを決定している。
この方法を第三者機関の存在を抜きにして実現するためには、取引は公に公開されなければならない。
また、取引の順序について参加者全員が１つの合意に達することができるようなシステムも必要である。
受取人に必要なのは、取引を行う際に、その取引が最初に受領されたことに参加者の大多数が合意しているということの証明である。


==タイムスタンプサーバー==

我々の提案する解決策として、まずタイムスタンプサーバーから説明する。
タイムスタンプサーバーはアイテムを纏めたブロックのハッシュをとり、それを広く公開する。
それはまさに新聞やUsenetのポストのようなものである。
タイムスタンプは、ある時間にあるデータが確かに存在していたことを証明する。
これは明らかに、ハッシュを計算するために必要だからである。
それぞれのタイムスタンプは直前のタイムスタンプをそのハッシュに含む。
そしてそれはチェーンを形成し、新たなタイムスタンプが追加されるたびにそれ以前のタイムスタンプの存在が強化されていく。

<img src=img/timestamp.png></img>


==Proof-of-Work==

タイムスタンプサーバーをピア・トゥー・ピアで実現するために、新聞紙やUsenetのポストよりも、Adam BackのHashcashに似たproof-of-workシステムを使う必要がある。
Proof-of-workは、SHA-256などである値をハッシュ化したときに、それがいくつかの0ビットで始まっているかどうかを調べる作業を伴う。
ここで要求される作業量は必要となる0ビットの数のべき乗となるが、認証に必要な作業は１回のハッシュ化のみである。

私達のタイムスタンプネットワークにおいては、ブロックのハッシュ値が要求される値を満たすまでブロック中に含まれるノンス値を増加させていくことでproof-of-workを実装することができる。
一度CPUの仕事がproof-of-workを満足させるほど十分に費やされたならば、それをやり直さない限りブロックの変更は不可能となる。
より後方にブロックがチェーンされていくと、あるブロックを変更するための仕事量はそれ以降の全てのブロックを変更するために必要な仕事量を含む。

<img src=img/proof-of-work.png></img>

Proof-of-workはまた、多数派の意思決定に関する合意形成の問題も解決する。
仮に1つのIPアドレスにつき１つの投票権を持つような仕組みにおいて多数派が規定されている場合、たくさんのIPアドレスを利用することができる人なら誰でも多数派を覆すことができる。
Proof-of-workとは本質的に、CPUにつき1つの投票権を持つようなものである。
多数派の選択は最長のチェーンという形で表現される。最長のチェーンには最も多くのproof-of-workへの仕事量が投入されているのだ。
CPUパワーの過半数が誠実な参加者によってコントロールされている限り、正当なチェーンは最も早く成長し、競合するチェーンを凌ぐ。
過去のブロックを変更するためには、攻撃者はそのブロックとそれ以降の全てのブロックについて最新のブロックに追いつき追い越すまでproof-of-workをやり直す必要があるだろう。
後のセクションで、後方にブロックが追加されるに従い、遅い攻撃者が追いつく可能性が指数関数的に減っていくことを示す。

ハードウェアの性能上昇やノードを運営することによる利益の変化に対応するため、proof-of-workの難易度は１時間に生成されるブロックの数が一定になるように調整される。
もし生成速度が早すぎれば、難易度は上昇する。


==ネットワーク==

ネットワークを運用するステップは以下のようである。

1. 新規トランザクションは全ノードにブロードキャストされる。

2. 各ノードは新規トランザクションをブロックに格納する。

3. 各ノードはそのブロックのproof-of-workを発見しようとする。

4. proof-of-workを発見したノードは、それを全体にブロードキャストする。

5. ノードはそのブロック内に含まれる全てのトランザクションが正当でかつ未だ使用されていないときのみそのブロックを受領する。

6. ノードは次のブロックの生成を開始することで、そのブロックを受領したことを知らせる。このとき受領したブロックのハッシュを"前のブロックのハッシュ"とするブロックの生成を開始する。

ノードは常に、最長のチェーンが正しいと考え、それを伸ばすように働く。
もし２つのノードがそれぞれ異なるブロックを同時にブロードキャストした場合、あるノードは一方を先に受け取り、あるノードはもう一方を先に受け取るかもしれない。
その場合、各ノードは最初に受け取ったブロックを正当なブロックとして扱い、そのブロックのチェーンを伸ばすように働く。
ただし、もう一方のブランチがより長くなった場合に備えて他方のブロックも保存しておく。
チェーンが分岐しているような状態は、次のproof-of-workが発見され一方が他方より長くなった時点でなくなるだろう。
最長でないブランチに貢献していたノードは直ちにより長いブランチに移動する。

新規トランザクションのブロードキャストは、必ずしも全てのノードに届く必要はない。
多数のノードに届いてさえいれば、やがてそれらがブロックに取り込んでくれるだろう。
ブロックのブロードキャストはまた、その欠落に対しても耐性がある。
もしあるノードがブロックを受信しなかった場合、その次のブロックの受信時にそのブロックの欠落に気がつく。
その後に欠落していたブロックを他のノードに対して要求すれば良い。


==インセンティブ==

慣例的に、ブロックに含まれる最初のトランザクションは特殊なトランザクションである。
それはブロックの作成者に保有される新規コインを発行するものである。
この仕組みはノードがネットワークをサポートするための動機づけとなる。
また、このネットワークにはいかなる中央管理者も存在しないため、この仕組みによって新しいコインが発行され流通していく。
このような安定した一定量の新規コインの発行は、金の採掘者がリソースを消費して金を発掘し流通させる事象に似ている。
今回のケースでは消費されるのは、CPUの時間と電力である。

手数料の収集もまた、ネットワークをサポートすることへの動機づけとなりうる。
もしアウトプットの額がインプットの額よりも少なければその差分が取引手数料となり、ブロック作成者への報酬へ追加される。
あらかじめ決められた量のコインが発行された段階で、ブロック作成者へのインセンティブは完全に取引手数料のみへと移行し、インフレーションを抑制する。

このようなインセンティブはまた、ノードが誠実に振る舞うことを促進する。
もし仮に強欲な攻撃者がより多くのCPUパワーを集められた場合、彼には２つの選択肢があることになる。
そのパワーを自分の支払いをなかったことにして人々を欺くことに使うか、新規コインを発行することに使うかである。
その場合、ルールに従い誰よりもたくさんのコインを発行できるほうが、システムを傷つけると同時に自身の富を傷つけるよりも良いという結論に達するはずだ。


==ディスクスペースの確保==

使用済みのトランザクションは、十分な数のブロックに承認されたならば、ディスクスペース節約のためにそのデータを破棄することができる。
ブロックハッシュの変更なくトランザクションデータの破棄を行うために、トランザクションはマークルツリーへとハッシュ化され、そのルートのみがブロックのハッシュに取り込まれる。
古いブロックはそのマークルツリーのブランチを削ることにより、データサイズをコンパクトにすることができる。
内部のハッシュを保存しておく必要はない。

<img src=img/reclaiming-disk.png></img>

トランザクションを除いたブロックヘッダーはおよそ80バイトほどのサイズになるだろう。
仮に10分ごとに１つのブロックが生成されるとすると、年間で4.2MBのデータ量となる。
2008年現在、一般的にコンピュータ業界は2GBのRAMを売っていること、またムーアの法則によると現在メモリの容量は年間1.2GBずつ増加しているということから、ストレージのサイズは問題にならないはずである。
仮にブロックヘッダーがメモリーに保存されなければならないとしても。


==簡素化された支払い認証（SPV）==

フルノードを走らせることなく支払いを認証することも可能である。
そのためにユーザーは最も長いproof-of-workチェーンのブロックヘッダーのコピーのみ保持していれば良い。
最長のチェーンのデータは、ネットワーク上の他のノードに対して自身が納得するまで要求することで手に入る。
その後、トランザクションとそれを含んでいるであろうブロックとをリンクするマークルブランチを取得する。
この手法ではトランザクションを自身でチェックすることはできないが、トランザクションをチェーン内のある場所とリンクさせることにより、ネットワークがそのトランザクションを受理したということを確認できる。
それ以降に追加されたブロックの存在によって、ネットワークがトランザクションを受け入れたという事実がより一層確かなものになっていく。

<img src=img/spv.png></img>

このように、支払いの確認はネットワークが誠実なノードによってコントロールされている限り信頼できるものである。
しかし攻撃者がより大きなパワーを持ったネットワークでは、それは不安定なものとなる。
ネットワークノードは自身でトランザクションを検証することができるが、攻撃者がネットワークに対してより大きな力を持ち続ける限り、簡素化された方法を利用しているノードは攻撃者が偽造したトランザクションに騙される可能性がある。
この攻撃に対処する一つの方法は、ネットワークノードが不正なブロックを検知した際にそれをSPVユーザーにアラートで知らせ、矛盾の検知のためにSPVノードにも全ブロックと問題のトランザクションとのダウンロードを促すことである。
とはいえやはり、頻繁にトランザクションを受け取るような企業の場合は、独立したセキュリティと素早い承認の実現のために自身でノードを走らせた方が良いだろう。



==金額の結合と分割==

コインをそれぞれ独立に扱うことが可能とはいえ、1セントごとに別々のトランザクションを作らなければならないのは少々扱いづらいだろう。
そのため、金額を結合したり分割したりできるように、トランザクションは複数のインプットとアウトプットを持つ。
通常、前回の大きな取引を参照する1つのインプットか、少額を組み合わせた複数のインプット、そして高々2つのアウトプットを持つ。
すなわち、支払い用アウトプットと、必要に応じて送金者に送り返すようなお釣り用アウトプットである。

<img src=img/combining-splitting.png></img>

あるトランザクションがいくつかのトランザクションに依存し、さらにそれらのトランザクションがより多くのトランザクションに依存していたとしても、それは問題にはならないということに言及しておく。
金額を結合・分割する際には、取引履歴の独立で完全なコピーを抽出する必要は全くないのだ。


==プライバシー==

今までのバンクモデルは、関係者への情報のアクセスを制限することでプライバシーを実現してきた。
しかし、取引をネットワーク全体に公表する必要がある以上、このような方法によるプライバシーの実現は不可能である。
しかし、情報の流れを別の場所で断つことによって、つまり公開鍵を匿名にすることで実現できる。
ネットワークの参加者は誰でも、”誰かが別の誰かに送金をしている”ということは分かるが、それが実際に誰なのかは分からない。
これは株式市場に似ている。各取引の時間と量は公開されているが、それが誰と誰の間で行われたものかという情報は公開されていない。

<img src=img/privacy.png></img>

さらなる防御策として、各取引が同じ所有者に紐付けられるのを防ぐために、取引ごとに新しいキーペアを使用すべきである。
しかしそのような取引の紐付けもある程度は避けられない。
なぜなら複数インプットを持つトランザクションは、それらのインプットが共通の所有者のものであることを示すからである。
ここに存在するリスクは、もしあるキーの所有者が判明したとき、取引の紐付けによって他の取引の所有者も同じであることが分かってしまうことである。


==計算==

攻撃者が誠実な参加者より早く悪意のあるチェーンを生成しようとしているケースを考える。
もし仮にそれに成功したとしても、システムが攻撃者によって任意に変更されるようになるということではない。
例えば、どこからともなくコインを生成したり、攻撃者とは一切関わりのないコインを奪ったりすることはできない。
各ノードは不正な取引を支払いとして受け入れないし、誠実なノードがそのような取引の入ったブロックを受け入れることもない。
攻撃者ができる唯一のことは、最近の支払いの内容を変更することくらいである。

攻撃者と誠実な参加者との間のレースは、Binomial Random Wlakとみなすことができる。
成功イベントは、誠実な参加者のチェーンが１ブロック伸び、リードを１つ分広げることである。
そして失敗イベントは、攻撃者のチェーンが１ブロック伸び、ギャップが１詰まることである。

攻撃者が与えられたギャップ分を埋めて正規のチェーンに追いつく可能性は、ギャンブラーの破産問題と類似している。
つまり、無限のクレジットを持つギャンブラーが、ある赤字額からスタートし、収支が五分になるまで何回でもある賭けを繰り返す場合を考えると、私達はギャンブラーが収益五分に達する可能性を計算することができる。
同様に、攻撃者が正規のチェーンに追いつく可能性を計算することができる。その方法を次に示す。

* TODO



==まとめ==

私達は信頼に依らない電子取引のシステムを提案した。
まず簡単なコインのフレームワークを示した。
そのコインは電子署名によって構成され、電子署名は強力な所有権の管理を可能にする。
しかし、二重支払い防止の方法がなければそのコインは依然不完全である。これを解決するために、proof-of-workによって取引履歴を保存するピア・トゥー・ピアのネットワークを提案した。
その仕組みは、誠実な参加者が消費されるCPUパワーの過半数を占めている限り、攻撃者による変更を計算上不可能にする。
ネットワークは構造化されておらずシンプルであるので、強固なものになる。
参加者全員は少量の共同作のもとで同時に働く。
メッセージは特定の場所に送られる必要はなく、最善努力のもと配送されれば良いので、参加者はそれぞれ区別される必要がない。
参加者はネットワークをいつでも離脱することができ、離脱中に起きた取引への証明としてproof-of-workチェーンを再参加時に受け取る。
参加者はブロックが正当か不正なものかについて、CPUパワーによる投票を行う。
つまり正当なブロックの受領を表すためにそれに続けてチェーンを伸ばし、不当なブロックの拒否を表すためにそれを無視してチェーンを伸ばす。
あらゆるルールとインセンティブは合意形成メカニズムによって強制される。
